@model EcomercerWebsite_Fruit.DataTransferObject.dtoCheckOut

@using EcomercerWebsite_Fruit.DataTransferObject
@{
    //List<CartDTO> cart = ViewBag.cart;

    List<dtoCart> cartItem = ViewBag.Cart;
    double total = 0;
    total = cartItem.Sum(m => m.Total);
    double subTotal = total;
    double tax = subTotal * 0.08;
}
<!-- Start All Title Box -->
<div class="all-title-box">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <h2>Checkout</h2>
                <ul class="breadcrumb">
                    <li class="breadcrumb-item"><a href="#">Shop</a></li>
                    <li class="breadcrumb-item active">Checkout</li>
                </ul>
            </div>
        </div>
    </div>
</div>
<!-- End All Title Box -->


<form class="needs-validation" novalidate asp-action="CheckOut" asp-controller="Cart">
    <div class="cart-box-main">
        <div class="container">
            <div class="row">
                <div class="col-sm-6 col-lg-6 mb-3">
                    <div class="checkout-address">
                        <div class="title-left">
                            <h3>Billing address</h3>
                        </div>

                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" asp-for="LikeAccount" name="LikeAccount" id="LikeAccount" value="false">
                            <label class="custom-control-label" for="LikeAccount">Shipping address is the same as my billing address</label>
                        </div>
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="save-info">
                            <label class="custom-control-label" for="save-info">Save this information for next time</label>
                        </div>
                        <hr class="mb-4">

                        <div class="mb-3 delivery-infor">
                            <label for="fullName delivery-infor">Receiver Name *</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="fullName" asp-for="Name" placeholder="" required>
                                <div class="invalid-feedback" style="width: 100%;"> Your name is required. </div>
                            </div>
                        </div>
                        <div class="mb-3 delivery-infor">
                            <label for="address">Address *</label>
                            <input type="text" class="form-control" asp-for="Address" id="address" placeholder="" required>
                            <div class="invalid-feedback"> Please enter your shipping address. </div>
                        </div>
                        <div class="mb-3 delivery-infor">
                            <label for="phone">Phone number *</label>
                            <input type="text" class="form-control" id="phone" asp-for="Phonenumber" placeholder="" required>
                            <div class="invalid-feedback"> Please enter your phone number for shipping contact. </div>
                        </div>

                        <hr class="mb-4">
                        <div class="title-left">
                            <h3>Shipping Method</h3>
                        </div>
                        <div class="d-block my-3">
                            <div class="custom-control custom-radio">
                                <input asp-for="ShippingFee" onClick="funcShip()" class="custom-control-input" id="deliveries1" name="ShippingFee" value="0" type="radio" checked required>
                                <label class="custom-control-label" for="deliveries1">Standard Delivery</label>
                                <span class="float-right font-weight-bold">FREE</span>
                            </div>
                            <div class="ml-4 mb-2 small">(3-7 business days)</div>
                            <div class="custom-control custom-radio">
                                <input asp-for="ShippingFee" onClick="funcShip()" id="deliveries2" class="custom-control-input" name="ShippingFee" value="20000" type="radio" required>
                                <label class="custom-control-label" for="deliveries2">Express Delivery</label>
                                <span class="float-right font-weight-bold">20.000.VND</span>
                            </div>
                            <div class="ml-4 mb-2 small">(2-4 business days)</div>
                            <div class="custom-control custom-radio">
                                <input asp-for="ShippingFee" onClick="funcShip()" id="deliveries3" class="custom-control-input" name="ShippingFee" value="35000" type="radio" required>
                                <label class="custom-control-label" for="deliveries3">Next Business day</label>
                                <span class="float-right font-weight-bold">35.000.VND</span>
                            </div>
                        </div>

                        <hr class="mb-1">
                    </div>
                </div>

                <div class="col-sm-6 col-lg-6 mb-3">
                    <div class="row">
                        <div class="col-md-12 col-lg-12">
                            <div class="shipping-method-box">
                                <div class="title-left">
                                    <h3>Payment Method</h3>
                                </div>
                                <div class="d-block my-3">
                                    <div class="custom-control custom-radio">
                                        <input id="cod" name="paymentMethod" asp-for="PaymentMethod" value="COD" type="radio" class="custom-control-input" required checked>
                                        <label class="custom-control-label" for="cod">Cash on Delivery</label>
                                    </div>
                                    <div class="custom-control custom-radio">
                                        <input id="debit" name="paymentMethod" asp-for="PaymentMethod" value="DEBIT" type="radio" class="custom-control-input" required>
                                        <label class="custom-control-label" for="debit">Debit card</label>
                                    </div>
                                    <div class="custom-control custom-radio">
                                        <input id="paypal" name="paymentMethod" asp-for="PaymentMethod" value="PAYPAL" type="radio" class="custom-control-input" required>
                                        <label class="custom-control-label" for="paypal">Paypal</label>
                                    </div>
                                </div>
                                <div class="row DebitCard">
                                    <div class="col-md-6 mb-3">
                                        <label for="cc-name">Name on card</label>
                                        <input type="text" class="form-control" id="cc-name" placeholder="" required>
                                        <small class="text-muted">Full name as displayed on card</small>
                                        <div class="invalid-feedback"> Name on card is required </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="cc-number">Credit card number</label>
                                        <input type="text" class="form-control" id="cc-number" placeholder="" required>
                                        <div class="invalid-feedback"> Credit card number is required </div>
                                    </div>
                                </div>
                                <div class="row DebitCard">
                                    <div class="col-md-3 mb-3">
                                        <label for="cc-expiration">Expiration</label>
                                        <input type="text" class="form-control" id="cc-expiration" placeholder="" required>
                                        <div class="invalid-feedback"> Expiration date required </div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="cc-cvv">CVV</label>
                                        <input type="text" class="form-control" id="cc-cvv" placeholder="" required>
                                        <div class="invalid-feedback"> Security code required </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="payment-icon">
                                            <ul>
                                                <li><img class="img-fluid" src="images/payment-icon/1.png" alt=""></li>
                                                <li><img class="img-fluid" src="images/payment-icon/2.png" alt=""></li>
                                                <li><img class="img-fluid" src="images/payment-icon/3.png" alt=""></li>
                                                <li><img class="img-fluid" src="images/payment-icon/5.png" alt=""></li>
                                                <li><img class="img-fluid" src="images/payment-icon/7.png" alt=""></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 col-lg-12">
                        <div class="odr-box">
                            <div class="title-left">
                                <h3>Shopping cart</h3>
                            </div>
                            <div class="rounded p-2 bg-light">
                                @foreach (var item in cartItem)
                                {
                                    <div class="media mb-2 border-bottom">
                                        <div class="media-body">
                                            <a href="detail.html">@item.ProductName</a>
                                            <div class="small text-muted">
                                                Price: @{
                                                    string cost = String.Format("{0:n}", item.ProductCost);
                                                }@cost .VND<span class="mx-2">|</span> Qty: @item.ProductAmount <span class="mx-2">|</span> Subtotal: @{
                                                    string subtotal = String.Format("{0:n}", item.ProductCost);
                                                }@subtotal .VND
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 col-lg-12">
                        <div class="order-box">
                            <div class="title-left">
                                <h3>Your order</h3>
                            </div>
                            <div class="d-flex">
                                <div class="font-weight-bold">Product</div>
                                <div class="ml-auto font-weight-bold">Total</div>
                            </div>
                            <hr class="my-1">
                            <div class="d-flex">
                                <h4>Sub Total</h4>
                                <div class="ml-auto font-weight-bold">
                                    @{
                                        string formatNumber = String.Format("{0:n}", total);
                                    }
                                    @formatNumber<span class="ml-auto font-weight-bold">.VND</span>
                                    @* <span class="ml-auto font-weight-bold" id="subTotal"></span> *@
                                </div>
                            </div>
                            <div class="d-flex">
                                <h4>Tax</h4>
                                <div class="ml-auto font-weight-bold">
                                    @{
                                        string taxformat = String.Format("{0:n}", tax);
                                    }
                                    @taxformat<span class="ml-auto font-weight-bold">.VND</span>
                                    @* <span class="ml-auto font-weight-bold" id="tax"></span> *@
                                </div>
                            </div>
                            <div class="d-flex">
                                <h4>Shipping Cost</h4>
                                <div class="ml-auto font-weight-bold">
                                    <span class="ml-auto font-weight-bold" id="shippingCost">0</span><span class="ml-auto font-weight-bold">.VND</span>
                                </div>
                            </div>
                            <hr>
                            <div class="d-flex gr-total">
                                <h5>Grand Total</h5>
                                <div class="ml-auto h5">
                                    @{
                                        double grandTotal = total + tax;
                                        string grandTotalFormat = String.Format("{0:n}", grandTotal);
                                    }
                                    <span class="ml-auto font-weight-bold" id="grandTotal">@grandTotalFormat</span><span class="ml-auto font-weight-bold">.VND</span>
                                </div>
                            </div>
                            <hr>
                        </div>
                    </div>
                    <div class="col-12 d-flex shopping-box">
                        <button type="submit" class="ml-auto btn hvr-hover">Place Order</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>






    
@section Scripts {
    <script>
        $(document).ready(function () {
            $("#LikeAccount").change(function () {
                if ($(this).prop("checked")) {
                    $(this).val(true);
                    $(".delivery-infor").addClass("d-none");
                } else {
                    $(this).val(false);
                    $(".delivery-infor").removeClass("d-none");
                }
            });
        });
        $(document).ready(function () {
            $('input[name="paymentMethod"]').change(function () {
                if ($('#cod').is(':checked')) {
                    $(".DebitCard").addClass("d-none");
                } else if ($('#debit').is(':checked') || $('#paypal').is(':checked')) {
                    $(".DebitCard").removeClass("d-none");
                }
            });

            // Trigger change event on page load to ensure correct display
            $('input[name="paymentMethod"]:checked').trigger('change');
        });
        
        function funcShip() {
           
            const ship = document.getElementsByName("ShippingFee");
            let selectedFee = 0;
            for (const option of ship) {
                if (option.checked) {
                    selectedFee = option.value;
                    break;
                }
            }

            const shipFee = Number(selectedFee);
            const total = @total;
            const tax = @tax;
            const grandTotal = total + tax + shipFee;
            const options = { minimumFractionDigits: 2, maximumFractionDigits: 2 };
            const shippingFee = shipFee.toLocaleString('en-US', options);
            const subTotal = total.toLocaleString('en-US', options);
            const taxFee = tax.toLocaleString('en-US', options);
            const GrandTotal = grandTotal.toLocaleString('en-US', options);
            document.getElementById("shippingCost").innerHTML = shippingFee;
            document.getElementById("grandTotal").innerHTML = GrandTotal;


        }

    </script>
}
